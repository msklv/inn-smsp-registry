# INN SMSP Registry Checker

Консольное приложение на Python для сверки списка ИНН с реестром "Единый реестр субъектов малого и среднего предпринимательства ФНС".

## Описание

Приложение проверяет список ИНН (идентификационных номеров налогоплательщиков) на соответствие с данными XML-реестра ФНС и создаёт выходной файл CSV с результатами проверки.

### Возможности

- Обработка CSV файла со списком ИНН
- Парсинг XML реестра ФНС (формат согласно структуре https://file.nalog.ru/opendata/7707329152-rsmp/structure-10062025.xsd)
- Поддержка ИНН юридических лиц (10 знаков) и физических лиц/ИП (12 знаков)
- Вывод результата в CSV формате с информацией: ИНН, статус (в реестре/не в реестре), код региона
- Эффективная обработка больших XML файлов через потоковый парсинг

## Установка

Приложение использует только стандартную библиотеку Python и не требует установки дополнительных зависимостей.

Требования:
- Python 3.9 или выше

## Использование

### Базовый синтаксис

```bash
python inn_registry_checker.py --input <входной_csv> --registry <xml_реестр> --output <выходной_csv>
```

### Параметры

- `-i, --input` - Входной CSV файл со списком ИНН (обязательный)
- `-r, --registry` - XML файл с данными реестра ФНС (обязательный)
- `-o, --output` - Выходной CSV файл с результатами (обязательный)

### Примеры

```bash
# Базовый пример
python inn_registry_checker.py --input inn_list.csv --registry registry.xml --output result.csv

# Короткий формат параметров
python inn_registry_checker.py -i input.csv -r data.xml -o output.csv

# Тестовый запуск с примерами файлов
python inn_registry_checker.py -i sample_input.csv -r sample_registry.xml -o sample_output.csv
```

## Формат входных данных

### Входной CSV файл

CSV файл с одним столбцом, содержащим ИНН (первый столбец используется, если есть несколько):

```csv
ИНН
7707329152
5004002414
1234567890
```

Или без заголовка:

```csv
7707329152
5004002414
1234567890
```

**Примечание**: В файле `sample_input.csv` содержатся примеры как реальных ИНН (которые будут найдены в `sample_registry.xml`), так и тестовых значений (1234567890, 9876543210), которые не будут найдены в реестре, для демонстрации работы приложения.

### XML реестр

XML файл должен соответствовать структуре реестра ФНС. Приложение ищет элементы:
- `<ИННЮЛ>` - для ИНН юридических лиц
- `<ИННФЛ>` - для ИНН физических лиц/ИП
- `<ОГРН>` - для извлечения кода региона

## Формат выходных данных

Выходной CSV файл содержит три столбца:

```csv
ИНН,В реестре,Код региона
7707329152,Да,77
5004002414,Нет,50
1234567890,Нет,12
```

- **ИНН** - проверяемый идентификационный номер
- **В реестре** - "Да" если ИНН найден в реестре, "Нет" если не найден
- **Код региона** - двузначный код региона (извлекается из ОГРН или первых двух цифр ИНН)

## Получение данных реестра

Актуальные данные реестра ФНС можно скачать с официального сайта:

1. Структура XSD: https://file.nalog.ru/opendata/7707329152-rsmp/structure-10062025.xsd
2. Данные реестра: https://www.nalog.gov.ru/opendata/7707329152-rsmp/

Файлы данных обычно публикуются в формате ZIP и содержат XML файлы большого размера.

## Производительность

- Приложение использует итеративный парсинг XML для эффективной работы с большими файлами
- Периодическая очистка памяти для обработки файлов размером в несколько гигабайт
- Прогресс-индикаторы при загрузке реестра и обработке данных

## Лицензия

MIT License - см. файл LICENSE
